
#include "token.h"

TEST(arith_with_comment) {
    TOKEN_TEST_INIT("abc: 1 + 2 * 3 - 45 / 67 // this is a comment");
    TOKEN_ASSERT(VAR, 0, 0, 0, 2);
    TOKEN_ASSERT(ASSIGN, 0, 3, 3, 3);
    TOKEN_ASSERT(INT, 0, 5, 5, 5);
    TOKEN_ASSERT(ADD, 0 , 7, 7, 7);
    TOKEN_ASSERT(INT, 0, 9, 9, 9);
    TOKEN_ASSERT(MUL, 0 , 11, 11, 11);
    TOKEN_ASSERT(INT, 0, 13, 13, 13);
    TOKEN_ASSERT(SUB, 0, 15, 15, 15);
    TOKEN_ASSERT(INT, 0, 17, 17, 18);
    TOKEN_ASSERT(DIV, 0, 20, 20, 20);
    TOKEN_ASSERT(INT, 0, 22, 22, 23);
    TOKEN_ASSERT(COMMENT, 0, 25, 25, 44);
    TOKEN_ASSERT(END, 0, 45, 45, 45);
}

TEST(fac_file) {
    char *file_str;
    file_status status = file_to_c_string("./examples/fac.lang", &file_str);
    if (status != FILE_STATUS_PFX(OK)) TEST_FAIL();
    TOKEN_TEST_INIT(file_str);
    TOKEN_ASSERT(NEWLINE, 0, 0, 0, 0);
    TOKEN_ASSERT(COMMENT, 1, 0, 1, 12);
    TOKEN_ASSERT(NEWLINE, 1, 12, 13, 13);
    TOKEN_ASSERT(VAR, 2, 0, 14, 16);
    TOKEN_ASSERT(ASSIGN, 2, 3, 17, 17);
    TOKEN_ASSERT(LBRACE, 2, 5, 19, 19);
    TOKEN_ASSERT(LPARENS, 2, 6, 20, 20);
    TOKEN_ASSERT(VAR, 2, 7, 21, 21);
    TOKEN_ASSERT(DEFINE, 2, 8, 22, 23);
    TOKEN_ASSERT(U64, 2, 10, 24, 26);
    TOKEN_ASSERT(RPARENS, 2, 13, 27, 27);
    TOKEN_ASSERT(LBRACKET, 2, 14, 28, 28);
    TOKEN_ASSERT(U64, 2, 15, 29, 31);
    TOKEN_ASSERT(RBRACKET, 2, 18, 32, 32);
    TOKEN_ASSERT(NEWLINE, 2, 19, 33, 33);
    TOKEN_ASSERT(RETURN, 3, 4, 38, 39);
    TOKEN_ASSERT(IF, 3, 7, 41, 42);
    TOKEN_ASSERT(LBRACE, 3, 10, 44, 44);
    TOKEN_ASSERT(NEWLINE, 3, 11, 45, 45);
    TOKEN_ASSERT(LPARENS, 4, 8, 54, 54);
    TOKEN_ASSERT(OR, 4, 9, 55, 55);
    TOKEN_ASSERT(LPARENS, 4, 10, 56, 56);
    TOKEN_ASSERT(VAR, 4, 11, 57, 57);
    TOKEN_ASSERT(EQ, 4, 13, 59, 59);
    TOKEN_ASSERT(INT, 4, 15, 61, 61);
    TOKEN_ASSERT(SEMICOLON, 4, 16, 62, 62);
    TOKEN_ASSERT(VAR, 4, 18, 64, 64);
    TOKEN_ASSERT(EQ, 4, 20, 66, 66);
    TOKEN_ASSERT(INT, 4, 22, 68, 68);
    TOKEN_ASSERT(RPARENS, 4, 23, 69, 69);
    TOKEN_ASSERT(RPARENS, 4, 24, 70, 70);
    TOKEN_ASSERT(LBRACE, 4, 26, 72, 72);
    TOKEN_ASSERT(INT, 4, 28, 74, 74);
    TOKEN_ASSERT(RBRACE, 4, 30, 76, 76);
    TOKEN_ASSERT(NEWLINE, 4, 31, 77, 77);
    TOKEN_ASSERT(LBRACE, 5, 8, 86, 86);
    TOKEN_ASSERT(VAR, 5, 10, 88, 88);
    TOKEN_ASSERT(MUL, 5, 12, 90, 90);
    TOKEN_ASSERT(VAR, 5, 14, 92, 94);
    TOKEN_ASSERT(LPARENS, 5, 17, 95, 95);
    TOKEN_ASSERT(VAR, 5, 18, 96, 96);
    TOKEN_ASSERT(SUB, 5, 20, 98, 98);
    TOKEN_ASSERT(INT, 5, 22, 100, 100);
    TOKEN_ASSERT(RPARENS, 5, 23, 101, 101);
    TOKEN_ASSERT(RBRACE, 5, 25, 103, 103);
    TOKEN_ASSERT(NEWLINE, 5, 26, 104, 104);
    TOKEN_ASSERT(RBRACE, 6, 4, 109, 109);
    TOKEN_ASSERT(NEWLINE, 6, 5, 110, 110);
    TOKEN_ASSERT(RBRACE, 7, 0, 111, 111);
    TOKEN_ASSERT(NEWLINE, 7, 1, 112, 112);
    TOKEN_ASSERT(NEWLINE, 8, 0, 113, 113);
    TOKEN_ASSERT(INT, 9, 0, 114, 114);
    TOKEN_ASSERT(READWRITE, 9, 2, 116, 117);
    TOKEN_ASSERT(CAST, 9, 5, 119, 119);
    TOKEN_ASSERT(STRING, 9, 6, 120, 121);
    TOKEN_ASSERT(CAST, 9, 8, 122, 122);
    TOKEN_ASSERT(VAR, 9, 10, 124, 126);
    TOKEN_ASSERT(LPARENS, 9, 13, 127, 127);
    TOKEN_ASSERT(INT, 9, 14, 128, 129);
    TOKEN_ASSERT(RPARENS, 9, 16, 130, 130);
    TOKEN_ASSERT(NEWLINE, 9, 17, 131, 131);
    TOKEN_ASSERT(INT, 10, 0, 132, 132);
    TOKEN_ASSERT(READWRITE, 10, 2, 134, 135);
    TOKEN_ASSERT(STRING, 10, 5, 137, 140);
    TOKEN_ASSERT(NEWLINE, 10, 9, 141, 141);
    TOKEN_ASSERT(END, 11, 0, 142, 142);
    free(str);
}

INIT_TESTS(
    ADD_TEST(arith_with_comment);
    ADD_TEST(fac_file);
);
